**Consumer Priority** à¦¹à¦²à§‹ RabbitMQ-à¦à¦° à¦à¦•à¦Ÿà¦¿ powerful feature, à¦¯à¦¾ à¦¨à¦¿à¦°à§à¦§à¦¾à¦°à¦£ à¦•à¦°à§‡:

ğŸ‘‰ **à¦•à§‹à¦¨ consumer à¦†à¦—à§‡ message à¦ªà¦¾à¦¬à§‡**
ğŸ‘‰ **High-priority consumer always gets messages before low-priority consumer**
ğŸ‘‰ **Load distribution à¦•à§‡ fully control à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ**

à¦à¦Ÿà¦¾ queue-level message priority à¦¨à§Ÿ â€”
à¦à¦Ÿà¦¾ à¦¹à¦²à§‹ **consumer-level priority**.

à¦šà¦²à§‹ à¦à¦•à¦¦à¦® à¦¸à¦¹à¦œà¦­à¦¾à¦¬à§‡ à¦¬à§à¦à¦¿ ğŸ‘‡

---

# ğŸŸ¦ **Consumer Priority à¦•à§€? (Easy Definition)**

à¦à¦•à¦Ÿà¦¿ queue-à¦¤à§‡ à¦¯à¦¦à¦¿ à¦à¦•à¦¾à¦§à¦¿à¦• consumer listening à¦•à¦°à§‡,
RabbitMQ à¦¤à¦¾à¦¦à§‡à¦° priority à¦¦à§‡à¦–à§‡ à¦ à¦¿à¦• à¦•à¦°à§‡ **à¦•à¦¾à¦•à§‡ à¦†à¦—à§‡ message à¦¦à§‡à¦¬à§‡**à¥¤

```
Priority high â†’ gets messages first  
Priority low â†’ gets messages only if high is idle
```

---

# ğŸŸ© Example (Simplest)

à¦§à¦°à§‹ à¦à¦•à¦‡ queue-à¦¤à§‡ à¦¦à§à¦‡à¦œà¦¨ consumer:

* Consumer A â†’ priority = 10
* Consumer B â†’ priority = 5

RabbitMQ behavior:

```
All messages â†’ Consumer A  
Consumer A idle à¦¹à¦²à§‡ â†’ Consumer B
```

**Priority à¦¬à§‡à¦¶à¦¿ = à¦¬à§‡à¦¶à¦¿ control**

---

# ğŸŸ¦ Diagram

```
Queue â†’ [Consumer P10] â†’ Always first
      â†’ [Consumer P5] â†’ Only when P10 busy/absent
```

---

# ğŸŸ§ à¦•à§‡à¦¨ Consumer Priority à¦¦à¦°à¦•à¦¾à¦°?

âœ” High-Speed consumer always gets messages
âœ” Slow consumer à¦•à§‡ message block à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ
âœ” Master worker > Backup worker model
âœ” Premium task > Normal task distribution
âœ” Zero downtime deployment (blue/green)
âœ” Heavy tasks prevent slow workers from blocking fast workers

---

# ğŸŸ¦ à¦¬à¦¾à¦¸à§à¦¤à¦¬ example (Microservice)

### âš¡ Scenario: Quiz Scoring System

* Primary scoring service = priority 10
* Backup scoring service = priority 1

Flow:
âœ” Primary always processes
âœ” Backup only runs when primary offline

This gives **high availability + efficiency**.

---

# ğŸŸ¦ How to set consumer priority in Spring Boot?

### âœ” Spring RabbitMQ Listener Annotation

```java
@RabbitListener(
    queues = "task.queue",
    arguments = @Argument(name = "x-priority", value = "10")
)
public void highPriorityConsumer(String msg) {
    System.out.println("High Priority Consumer: " + msg);
}
```

Low priority consumer:

```java
@RabbitListener(
    queues = "task.queue",
    arguments = @Argument(name = "x-priority", value = "1")
)
public void lowPriorityConsumer(String msg) {
    System.out.println("Low Priority Consumer: " + msg);
}
```

---

# ğŸŸ© Alternative way (manual container config)

```java
@Bean
public SimpleRabbitListenerContainerFactory priorityFactory(
        ConnectionFactory connectionFactory) {

    SimpleRabbitListenerContainerFactory factory =
            new SimpleRabbitListenerContainerFactory();

    factory.setConnectionFactory(connectionFactory);

    Map<String, Object> args = new HashMap<>();
    args.put("x-priority", 20);

    factory.setConsumerArguments(args);

    return factory;
}
```

Then use:

```java
@RabbitListener(queues = "task.queue", containerFactory = "priorityFactory")
public void process(String msg) { ... }
```

---

# ğŸŸ¥ Common Mistakes (Be Careful)

âŒ Priority always works ONLY inside the same queue
âŒ If prefetch is high â†’ low priority consumers may still receive bursts
âŒ Does not reorder messages â†’ only selects *which consumer* will take them

---

# ğŸŸ¦ Best Practices

### 1ï¸âƒ£ High-performance worker â†’ priority = 10

### 2ï¸âƒ£ Backup/failover worker â†’ priority = 1

### 3ï¸âƒ£ Canary/blue-green deployment â†’ priority tune à¦•à¦°à§‡ rollout

### 4ï¸âƒ£ VIP message routing â†’ use priority consumers

---

# â­ One-Line Summary

ğŸ‘‰ **Consumer Priority = RabbitMQ decides which consumer gets messages first â€” high priority consumers always win.**

---

# à¦¯à¦¦à¦¿ à¦šà¦¾à¦“ ğŸ”¥

à¦†à¦®à¦¿ à¦¦à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à¦¿:

âœ” Consumer Priority + Prefetch + Retry â†’ Best optimized architecture
âœ” Priority-based traffic routing diagram
âœ” High-availability worker pool design
âœ” Full Java code with multiple prioritized worker services

Which one do you want next?
