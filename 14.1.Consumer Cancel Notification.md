**Consumer Cancel Notification** à¦¹à¦²à§‹ RabbitMQ-à¦à¦° à¦à¦•à¦Ÿà¦¿ à¦–à§à¦¬à¦‡ à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ mechanism, à¦¯à¦¾ à¦¬à¦²à§‡ à¦¦à§‡à§Ÿ:

ğŸ‘‰ **Consumer à¦†à¦° queue consume à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾**
ğŸ‘‰ **RabbitMQ à¦¸à§‡à¦‡ consumer-à¦•à§‡ cancel à¦•à¦°à§‡ à¦¦à¦¿à§Ÿà§‡à¦›à§‡**
ğŸ‘‰ **Consumer-side à¦•à§‡ à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦à¦° à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡ à¦œà¦¾à¦¨à¦¾à¦¨à§‹ à¦¹à§Ÿ**

à¦à¦Ÿà¦¾ Microservice / Messaging System à¦ à¦…à¦¤à§à¦¯à¦¨à§à¦¤ critical eventà¥¤

à¦šà¦² à¦§à¦¾à¦ªà§‡ à¦§à¦¾à¦ªà§‡ à¦¬à§à¦à¦¿ ğŸ‘‡

---

# ğŸŸ¦ **Consumer Cancel Notification à¦•à§€? (Super Easy Definition)**

à¦¯à¦–à¦¨ RabbitMQ à¦•à§‹à¦¨à§‹ Consumer-à¦•à§‡ à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¤à§‡ à¦¨à¦¾ à¦¦à§‡à§Ÿ à¦¬à¦¾ consume permission à¦¬à¦¾à¦¤à¦¿à¦² à¦•à¦°à§‡,
RabbitMQ à¦¸à§‡à¦‡ Consumer-à¦•à§‡ à¦à¦•à¦Ÿà¦¿ **Cancel Notification** à¦ªà¦¾à¦ à¦¾à§Ÿà¥¤

à¦®à¦¾à¦¨à§‡:

```
âŒ Consumer à¦†à¦° queue à¦¥à§‡à¦•à§‡ message consume à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡ à¦¨à¦¾
âŒ RabbitMQ à¦“à¦‡ consumer-à¦à¦° subscription à¦¬à¦¨à§à¦§ à¦•à¦°à§‡ à¦¦à¦¿à§Ÿà§‡à¦›à§‡
```

---

# ğŸŸ¥ à¦•à§‡à¦¨ RabbitMQ Consumer Cancel à¦•à¦°à§‡?

RabbitMQ à¦¨à¦¿à¦šà§‡à¦° à¦•à¦¾à¦°à¦£à§‡ consumer cancel à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡:

## 1ï¸âƒ£ Queue deleted

à¦¯à¦¦à¦¿ queue delete à¦•à¦°à¦¾ à¦¹à§Ÿ:

```
Consumer â†’ CANCEL
```

## 2ï¸âƒ£ Queue auto-delete triggered

à¦¯à§‡à¦®à¦¨:

```java
new Queue("test", true, false, true)
```

`autoDelete = true` à¦¹à¦²à§‡ last consumer unsubscribed à¦¹à¦²à§‡ queue delete à¦¹à§Ÿà§‡ à¦¯à¦¾à§Ÿ â†’
RabbitMQ â†’ Cancel Notification à¦ªà¦¾à¦ à¦¾à§Ÿà¥¤

## 3ï¸âƒ£ Access Refused

Consumer-à¦à¦° permission à¦¨à¦¾ à¦¥à¦¾à¦•à¦²à§‡:

```
access-refused â†’ consumer cancel
```

## 4ï¸âƒ£ Exclusive consumer/queue conflict

à¦à¦•à¦Ÿà¦¿ queue à¦¯à¦¦à¦¿ exclusive à¦¹à§Ÿ:

```
consumer-1 attached â†’ consumer-2 will get cancel notification
```

## 5ï¸âƒ£ Server-side shutdown / cluster failover

RabbitMQ node fail à¦¹à¦²à§‡ consumer cancel à¦¹à§Ÿà¥¤

## 6ï¸âƒ£ Internal errors (rare)

Consumer tag invalid à¦¹à¦²à§‡ cancel à¦¹à§Ÿà¥¤

---

# ğŸŸ© Real Flow Diagram

```
Consumer â†’ SUBSCRIBE to queue
Queue deleted / permission error / exclusive conflict
RabbitMQ â†’ CONSUMER CANCEL NOTIFICATION â†’
Consumer receives CANCEL event
Consumer must stop and clean up
```

---

# ğŸŸ¦ Spring Boot / Java-à¦ à¦•à¦¿à¦­à¦¾à¦¬à§‡ à¦§à¦°à¦¬à§‡?

à¦¤à§à¦®à¦¿ Consumer Cancel event à¦§à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‹ **ChannelAwareMessageListener** à¦¬à¦¾ **RabbitListenerContainerFactory Listener** à¦¦à¦¿à§Ÿà§‡à¥¤

### âœ” Example 1: Listener to Capture Cancel Event

```java
@Bean
public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory(
        ConnectionFactory connectionFactory) {

    SimpleRabbitListenerContainerFactory factory =
            new SimpleRabbitListenerContainerFactory();

    factory.setConnectionFactory(connectionFactory);

    factory.setConsumerTagStrategy(queue -> "my-consumer");

    factory.setMissingQueuesFatal(false); // avoids crash

    factory.setConsumerStartTimeout(5000L);

    factory.setConsumerFailedEventsHandler(event -> {
        System.out.println("âŒ Consumer Cancel Notification: " + event);
    });

    return factory;
}
```

Spring Boot 3 à¦¥à§‡à¦•à§‡ à¦¤à§à¦®à¦¿ consumer failed events handle à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‹à¥¤

---

### âœ” Example 2: Manual Consumer Cancel Handler (Channel API)

```java
channel.basicConsume("my.queue", false,
        "my-consumer-tag",
        false,
        false,
        null,
        new DefaultConsumer(channel) {
            @Override
            public void handleCancel(String consumerTag) throws IOException {
                System.out.println("âŒ Consumer Cancelled: " + consumerTag);
            }

            @Override
            public void handleCancelOk(String consumerTag) {
                System.out.println("âš ï¸ Consumer Cancel Notification Received");
            }
        });
```

---

# ğŸŸ§ Cancellation Scenario Example

à¦§à¦°à§‹:

1. Consumer A is listening:

   ```
   queue = "quiz.result.queue"
   ```

2. Admin deletes the queue (mistake or clean-up)

3. RabbitMQ sends:

```
Cancel Consumer  
Cause: queue-deleted  
```

4. Consumer application receives event:

```
âŒ Consumer Cancelled: quiz.result.queue
```

5. Consumer should:

* Stop consuming
* Log error
* Retry connection
* Alert system / devops

---

# ğŸŸ¦ Why Consumer Cancel Notification Is Important?

âœ” Broken consumer detect à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ
âœ” Auto-recovery trigger à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿ
âœ” High-availability ensure à¦¹à§Ÿ
âœ” Queue mistakenly deleted à¦¹à¦²à§‡ à¦œà¦¾à¦¨à¦¾ à¦¯à¦¾à§Ÿ
âœ” Permission issue detect à¦¹à§Ÿ
âœ” Microservice auto-reconnect à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡

---

# ğŸŸ© One-line Summary

ğŸ‘‰ **Consumer Cancel Notification = RabbitMQ tells your consumer: â€œStop! You canâ€™t consume this queue anymore.â€**

---

# à¦¯à¦¦à¦¿ à¦šà¦¾à¦“ ğŸ”¥

à¦†à¦®à¦¿ à¦¦à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à¦¿â€”

âœ” Consumer Auto-Recovery Architecture
âœ” Java Code for auto-reconnect
âœ” Cancel Notification full lifecycle diagram
âœ” HA + Retry + DLQ + Monitoring integrated architecture

Which one do you want?
