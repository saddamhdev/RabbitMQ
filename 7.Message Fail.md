тАЬ**Message fail**тАЭ ржорж╛ржирзЗ RabbitMQ ржХрзЛржирзЛ ржХрж╛рж░ржгрзЗ **ржорзЗрж╕рзЗржЬржЯрж╛ ржарж┐ржХржорждрзЛ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржирж┐**тАФрж╕рзЗржЗ ржорзЗрж╕рзЗржЬржЯрж╛ржХрзЗ **dead letter** ржзрж░рж╛ рж╣ржпрж╝ ржПржмржВ DLX-ржП ржкрж╛ржарж┐ржпрж╝рзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝ред

RabbitMQ-рждрзЗ **message fail** рж╣ржУрзЯрж╛рж░ рзлржЯрж┐ рж╕рзНржкрж╖рзНржЯ ржХрж╛рж░ржг ржЖржЫрзЗред

ржЖржорж┐ ржПржХ ржПржХ ржХрж░рзЗ ржЦрзБржм рж╕рж╣ржЬ ржнрж╛рж╖рж╛ржпрж╝ ржЙржжрж╛рж╣рж░ржгрж╕рж╣ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржЫрж┐ ЁЯСЗ

---

# ЁЯЯе 1я╕ПтГг Consumer exception тАФ **ржЖржкржирж╛рж░ ржХрзЛржб error ржжрзЗржпрж╝**

ржпржЦржи consumer ржорзЗрж╕рзЗржЬ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рждрзЗ ржЧрж┐ржпрж╝рзЗ exception ржЫрзЛрзЬрзЗ:

```java
throw new RuntimeException("DB down");
```

тЮбя╕П рждржЦржи RabbitMQ ржоржирзЗ ржХрж░рзЗ ржорзЗрж╕рзЗржЬржЯрж┐ FAILED
тЮбя╕П ржПржмржВ рж╕рзЗржЯрж╛ржХрзЗ DLX-ржП ржкрж╛ржарж╛рзЯ

ржПржХржерж╛ржХрзЗ message failure ржмрж▓рзЗред

---

# ЁЯЯе 2я╕ПтГг Consumer тАЬrejectтАЭ ржХрж░рзЗ тЖТ **basic.reject()**

ржпржжрж┐ consumer ржирж┐ржЬрзЗрж░ ржерзЗржХрзЗржЗ reject ржХрж░рзЗ:

```java
channel.basicReject(deliveryTag, false);
```

тЮбя╕П ржорзЗрж╕рзЗржЬ FAIL
тЮбя╕П рж╕рж░рж╛рж╕рж░рж┐ DLX-ржП ржЪрж▓рзЗ ржпрж╛рзЯ

---

# ЁЯЯе 3я╕ПтГг Consumer тАЬnackтАЭ ржХрж░рзЗ тЖТ **basic.nack()**

ржпржжрж┐ consumer nack (negative-acknowledge) ржХрж░рзЗ:

```java
channel.basicNack(tag, false, false);
```

тЮбя╕П Fail
тЮбя╕П DLX-ржП ржлрж░ржУрзЯрж╛рж░рзНржб

---

# ЁЯЯе 4я╕ПтГг Queue TTL рж╢рзЗрж╖ рж╣ржУрзЯрж╛ (Message expired)

ржорзЗрж╕рзЗржЬ ржпржжрж┐ queue-рждрзЗ ржЕржирзЗржХржХрзНрж╖ржг ржерж╛ржХрзЗ (TTL = Time To Live):

```
x-message-ttl: 5000 ms
```

5 рж╕рзЗржХрзЗржирзНржб ржкрж░ ржпржжрж┐ ржорзЗрж╕рзЗржЬ ржкрзНрж░рж╕рзЗрж╕ ржирж╛ рж╣рзЯ тЖТ

тЮбя╕П ржорзЗрж╕рзЗржЬ expired
тЮбя╕П FAIL
тЮбя╕П DLX-ржП ржпрж╛рзЯ

---

# ЁЯЯе 5я╕ПтГг Queue full тЖТ ржорзЗрж╕рзЗржЬ ржврзБржХрж╛рждрзЗ ржирж╛ ржкрж╛рж░рж╛

ржпржжрж┐ queue-ржПрж░ max length / max byte limit ржкрзВрж░рзНржг рж╣рзЯрзЗ ржпрж╛рзЯ:

тЮбя╕П ржирждрзБржи ржорзЗрж╕рзЗржЬ ржврзБржХржмрзЗ ржирж╛
тЮбя╕П FAIL
тЮбя╕П DLX-ржП рж░рж┐ржбрж╛ржЗрж░рзЗржХрзНржЯ рж╣ржмрзЗ

---

# ЁЯЯй рж╕рж╣ржЬ ржнрж╛рж╖рж╛ржпрж╝ тАФ тАЬMessage failтАЭ ржорж╛ржирзЗ ржХрзА?

### ЁЯСЙ Consumer ржорзЗрж╕рзЗржЬ ржирж┐рждрзЗ ржкрж╛рж░рж▓рзЛ ржирж╛

### ЁЯСЙ Consumer ржорзЗрж╕рзЗржЬ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рждрзЗ ржЧрж┐рзЯрзЗ error ржжрж┐рж▓

### ЁЯСЙ Consumer reject/nack ржХрж░рж▓рзЛ

### ЁЯСЙ TTL рж╢рзЗрж╖ (expire рж╣рж▓рзЛ)

### ЁЯСЙ Queue full рж╣рзЯрзЗ ржЧрзЗржЫрзЗ

ржПржЗ ржпрзЗржХрзЛржирзЛ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рждрзЗ RabbitMQ ржмрж▓ржмрзЗ:

```
Message failed тЖТ Send to DLX
```

рждрж╛рж░ржкрж░ DLX рж░рж╛ржЙржЯрж┐ржВ ржХрж░рзЗ ржорзЗрж╕рзЗржЬржХрзЗ DLQ (dead letter queue) ржмрж╛ retry queue-рждрзЗ ржкрж╛ржарж╛рзЯред

---

# ЁЯЯж ржЖржкржирж╛рж░ рж╕рж┐рж╕рзНржЯрзЗржорзЗ тАЬmessage failтАЭ ржХрзАржнрж╛ржмрзЗ рж╣рзЯ?

ржЖржкржирж╛рж░ рж╕ржм consumer-ржПржЗ retry system ржЖржЫрзЗред

ржпржЦржи ржЖржкржирж┐ exception ржЫрзЛрзЬрзЗржи:

```java
throw new RuntimeException("DB Insert Failed");
```

тЪая╕П ржПржЗржЯрж╛ржХрзЗржЗ RabbitMQ тАЬmessage failedтАЭ ржмрж▓рзЗред

рждрж╛рж░ржкрж░ RetryHandler рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗрзЯ:

* Retry queue-ржП ржкрж╛ржарж╛ржмрзЗ?
* ржирж╛ржХрж┐ Final DLQ-рждрзЗ ржкрж╛ржарж╛ржмрзЗ?

---

# ЁЯЯй FINAL SUMMARY

тАЬ**Message fail**тАЭ = ржорзЗрж╕рзЗржЬржЯрж┐ **ржмрж░рзНрждржорж╛ржи queue ржмрж╛ consumer-ржП ржкрзНрж░рж╕рзЗрж╕ ржХрж░рж╛ рж╕ржорзНржнржм рж╣рзЯржирж┐ред**

RabbitMQ рждржЦржи рж╕рзЗржЗ ржорзЗрж╕рзЗржЬржХрзЗ:

```
Main Queue тЖТ DLX тЖТ Retry Queue тЖТ DLX тЖТ Retry Queue тЖТ DLX тЖТ Final DLQ
```

ржПржЗ flow-рждрзЗ ржкрж╛ржарж╛рзЯ (ржЖржкржирж╛рж░ exponential backoff ржЕржирзБржпрж╛рзЯрзА)ред

---

# ЁЯСЙ ржЪрж╛ржЗрж▓рзЗ ржЖржорж┐ ржЖрж░ржУ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рждрзЗ ржкрж╛рж░рж┐:

### тЬФ ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

### тЬФ ржЪрж┐рждрзНрж░ (Diagram)

### тЬФ Live simulation

### тЬФ Producer / Consumer error flow animation

ржпрзЗржЯрж╛ ржЪрж╛ржи ржмрж▓рзБржи!
